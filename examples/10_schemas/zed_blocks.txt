// ============================================================================
// Example: Zed Blocks (zed...end)
// ============================================================================
// Demonstrates:
//   - zed...end block syntax
//   - Multiple definitions in one block
//   - Alternative to individual axdef/schema blocks
//   - Grouping related definitions
//
// Features:
//   - zed ... end [block containing multiple definitions]
//   - Can contain: given, schema, axdef, abbrev, free types
//   - Groups logically related specifications
//
// See: docs/USER_GUIDE.md - Section "Schemas" > "Zed Blocks"
// ============================================================================

=== Zed Block Examples ===

** Example 1: Basic Zed Block **

TEXT: A zed block can contain multiple definitions:

zed
  given Person, Department

  assignment : Person +-> Department
  employees : F Person
  departments : F Department
end

TEXT: This groups related type declarations and variables in a single block.

** Example 2: Zed Block with Constraints **

zed
  given Account, Balance

  accounts : Account +-> Balance
  totalBalance : Balance
where
  totalBalance = sum(ran accounts)
  dom accounts /= emptyset
end

TEXT: Constraints apply to all definitions in the block.

** Example 3: Schema Within Zed Block **

zed
  schema BankAccount
    accountNumber : N
    balance : Z
  where
    balance >= 0
  end

  schema Transaction
    from : BankAccount
    to : BankAccount
    amount : N
  where
    amount > 0
    from.balance >= amount
  end
end

TEXT: Multiple schemas can be defined in a single zed block.

** Example 4: Mixed Definitions **

zed
  given Student, Course

  enrolled : Student <-> Course
  maxCourses : N
  maxStudents : N

  schema Enrollment
    students : F Student
    courses : F Course
  where
    students = dom enrolled
    courses = ran enrolled
  end
where
  maxCourses = 7
  maxStudents = 500
  forall s : Student | # (enrolled(| {s} |)) <= maxCourses
  forall c : Course | # (enrolled~(| {c} |)) <= maxStudents
end

TEXT: Combines given types, variables, a schema, and constraints.

** Example 5: Abbreviations in Zed Block **

zed
  N_PLUS == {n : N | n > 0}
  N_EVEN == {n : N | n mod 2 = 0}
  N_ODD == {n : N | n mod 2 = 1}
end

TEXT: Group related abbreviations together.

** Example 6: Free Types in Zed Block **

zed
  Color ::= red | green | blue
  Size ::= small | medium | large

  schema Product
    color : Color
    size : Size
    price : N
  where
    price > 0
  end
end

TEXT: Free type definitions with schemas using those types.

** Example 7: Functions in Zed Block **

zed
  given Item, Quantity

  inventory : Item +-> Quantity
  available : Item -> B
  inStock : P Item
where
  forall i : Item | available(i) = (i in dom inventory and inventory(i) > 0)
  inStock = {i : Item | available(i) = true}
end

TEXT: Functions and predicates defined together.

** Example 8: Nested Schemas **

zed
  schema Address
    street : seq Char
    city : seq Char
    zipCode : N
  where
    zipCode >= 10000 and zipCode <= 99999
  end

  schema Person
    name : seq Char
    address : Address
    age : N
  where
    age >= 0 and age <= 150
  end

  population : F Person
end

TEXT: Schema Address is used within schema Person, both in the same zed block.

** Example 9: Constants and Derived Values **

zed
  PI == 314159 / 100000
  E == 271828 / 100000

  circumference : N -> N
  area : N -> N
where
  forall r : N | circumference(r) = 2 * PI * r
  forall r : N | area(r) = PI * r * r
end

TEXT: Mathematical constants with functions using them.

** Example 10: Comparison - Individual Blocks vs Zed Block **

TEXT: Individual blocks (more verbose):

given Account, Balance

axdef
  accounts : Account +-> Balance
end

axdef
  totalBalance : Balance
where
  totalBalance = sum(ran accounts)
end

TEXT: Zed block (more concise):

zed
  given Account, Balance

  accounts : Account +-> Balance
  totalBalance : Balance
where
  totalBalance = sum(ran accounts)
end

TEXT: The zed block groups related definitions and shares constraints.

** Example 11: Large Specification Example **

zed
  given UserID, DocumentID, PermissionType

  PermissionType ::= read | write | admin

  schema User
    id : UserID
    documents : P DocumentID
    permissions : DocumentID +-> PermissionType
  where
    dom permissions subseteq documents
  end

  schema System
    users : UserID +-> User
    allDocuments : F DocumentID
  where
    allDocuments = bigcup {u : ran users . u.documents}
  end

  canRead : UserID cross DocumentID -> B
  canWrite : UserID cross DocumentID -> B
where
  forall uid : UserID; did : DocumentID |
    canRead(uid, did) = (did in (users(uid)).documents and
                         (users(uid)).permissions(did) in {read, write, admin})

  forall uid : UserID; did : DocumentID |
    canWrite(uid, did) = (did in (users(uid)).documents and
                          (users(uid)).permissions(did) in {write, admin})
end

TEXT: A complete permission system specification in a single zed block.

** Example 12: Best Practices **

TEXT: Use zed blocks when:
TEXT: 1. Multiple definitions are logically related
TEXT: 2. Definitions share constraints or types
TEXT: 3. You want to group a complete subsystem
TEXT: 4. Reducing verbosity improves readability

TEXT: Use individual blocks when:
TEXT: 1. Definitions are independent
TEXT: 2. Each has distinct, complex constraints
TEXT: 3. You want maximum clarity and separation
TEXT: 4. Definitions will be referenced separately

TEXT: Both styles are validâ€”choose based on your specification structure and readability needs.
